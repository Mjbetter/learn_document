# 机器视觉概述  
- 机器视觉系统是基于机器视觉技术或自动化生产线建立的一套视觉系统，被广泛应用在生产制造等行业，可用来保证产品质量，控制生产流程，感知环境等。  
## 一、机器视觉系统的优势
- 空间分辨力：通过配置各种光学镜头可以观测小到微米，大到天体的目标。  
- 速度：相机快门时间可达微秒级，高速相机帧率可达1000以上。  
- 感光范围：从紫外到红外很宽的光谱范围，还有X特殊相机。  
- 环境要求：对环境适应力强，可以加防护装置。  
- 灰度分辨力： 目前一般多使用8bit，256灰度等级，采集系统可以具有10bit、12bit、16bit等灰度等级。  
- 非接触测量。  
## 二、机器视觉系统构成    
&nbsp;&nbsp;&nbsp;&nbsp;**常见的组成部分包括两大部分：**
- 图像获取：照明光源，光学镜头，工业相机，图像采集卡。
 - 图像处理：图像处理软件。
## 三、照明光源
- 使用照明光源的目的：将被测物体与背景尽量明显分别，获得高品质，高对比对的图像。
- 使用照明光源的重要性：直接影响处理的精度和速度，甚至系统的成败。
- 常见的照明光源如图所示：  
  ![image](https://github.com/Mjbetter/learn_document/assets/102216757/d8d4ba43-15e5-4661-9740-2be87d145749)  
- 以上三种照明光源的各方面性能：  
  ![image](https://github.com/Mjbetter/learn_document/assets/102216757/8c83ee52-029c-4269-9d17-fc9c62362dec)  
- 两种常见的正向打光方式  
  - 亮视野和暗视野，如图是它们的打光示意图和结果图  
    ![image](https://github.com/Mjbetter/learn_document/assets/102216757/abe1a5cb-191a-4e56-b3f9-4e8d0429fcae)![image](https://github.com/Mjbetter/learn_document/assets/102216757/1c22077c-b5d0-45e7-a7d4-0bb06008f112)   
- 以下分别展示了低角度打光，前向光，LED灯+扩散板，背光  
  ![image](https://github.com/Mjbetter/learn_document/assets/102216757/d5aafa9b-dbcf-4c8f-a06f-a3eb30fa7c3a)![image](https://github.com/Mjbetter/learn_document/assets/102216757/53499299-823c-434c-98e8-71720d758e5a)![image](https://github.com/Mjbetter/learn_document/assets/102216757/d5aafa9b-dbcf-4c8f-a06f-a3eb30fa7c3a)![image](https://github.com/Mjbetter/learn_document/assets/102216757/c09a58ab-f23e-464c-a7bc-78087ae43fd4)  
- 当光源照射到物体的时候，会根据物体的颜色，反射相同颜色的光路，吸收其他颜色的光路。所以人眼就能看到物体的颜色。以下是反射示意图和物体成像图。  
  ![image](https://github.com/Mjbetter/learn_document/assets/102216757/59e56af6-d525-4cd2-a770-508b7a551c4a)![image](https://github.com/Mjbetter/learn_document/assets/102216757/0a5c6352-3c99-4cd5-8628-4135c9c26756)  
## 四、光学镜头  
- 镜头兼容芯片尺寸和相机芯片尺寸关系  
  -对于镜头的像圈，我们使用的最大尺寸ccd如图所示，同时，使用更小的ccd尺寸是允许的，最后成像只会在ccd上形成，如果传感器的大小太大，那么就会出现渐晕(隧道效应或者阴影)![image](https://github.com/Mjbetter/learn_document/assets/102216757/6c6e0ff8-483e-449a-bfcd-49ac18e6d31a)  
- 镜头畸变  
  - 筒形畸变  
    - 筒形畸变是一种凸透镜(广角镜头)常见的畸变形式。在筒形畸变中，图像中心附近的直线会呈现向外弯曲的形状，像是放在一个桶里一样。这种畸变导致了物体的形变，使得物体的边缘部分显得更加扩散和凸出。  
  - 枕形畸变  
    - 枕形畸变是一种凹透镜(长焦镜头)常见的畸变形式。在枕形畸变中，图像中心附近的直线会呈现向内弯曲的形状，像是放在一个枕头上一样，这种畸变会使得物体的边缘部分显得更加收缩和凹陷。![image](https://github.com/Mjbetter/learn_document/assets/102216757/717ab169-5073-4523-9210-4cc9622b98e2)  
- 景深  
  - 景深是指在摄影或摄像中，在一个相机设置下，能够保持清晰焦点的前后距离范围。它是由相机的焦距，光圈大小，拍摄距离和镜头的焦点距离共同决定的。  
  - 景深可以分成浅景深和后景深两种情况  
    - 浅景深：当相机对焦在一个特定的距离上时，只有焦点附近的物体才会处于清晰状态，而在焦点前后的物体会呈现模糊的效果，这种情况通常在使用大光圈(小F数)和较长焦距的镜头时出现。例如人像摄影中常见的背景虚化效果。  
    - 深景深：当相机对焦在一个特定的距离上时，较大范围内的物体都能够保持清晰焦点，前后的物体也能够较为清晰地呈现。这种情况通常在使用小光圈（大F数）和较短焦距的镜头时出现，例如风景摄影中常见的整体清晰效果。  
  - 景深的大小受到多个因素的影响，包括焦距、光圈大小、相机与被摄物体的距离以及镜头的焦点距离等。较小的光圈（大F数）、较短的焦距、较远的拍摄距离以及较小的焦点距离会增加景深的范围，而较大的光圈（小F数）、较长的焦距、较近的拍摄距离以及较大的焦点距离会减小景深的范围。  
  - 在较浅景深下，对焦点前面的景深范围会比对焦点后面的景深范围小，但当焦距越长时，前后的范围便会越来越接近了。例如这张图，焦点在前车轮，那么它的景深范围就是车轮往前1/3，往后2/3处。![image](https://github.com/Mjbetter/learn_document/assets/102216757/5d701a53-6b72-4654-aad8-29f7ed057d5e)  
 - 物距，焦距，放大率  
   - 物距是指物体与镜头或相机之间的距离。它表示了物体离相机的远近程度。物距越远，物体在成像中的大小越小，物距越近，物体在成像中的大小越大。  
   - 焦距是指从镜头到焦点的距离，焦距决定了镜头的视角和成像特性，较短的焦距会产生更广角的视野，使得拍摄的场景较为宽广，较长的焦距会产生较窄的视野，使得拍摄的场景较为局限。  
   - 放大率是指物体在成像中相对于实际大小的放大比例。它表示了成像中物体的大小与实际物体大小之间的关系。
     $$放大率：\beta=\frac{y'}{y}=\frac{l'}{l}$$
     $$物距：l=f(1+1/\beta)$$
     $$焦距：f=l/(1+1/\beta)$$
## 五、工业相机  
- 工业相机常见分类  
  - 按照输出色彩可以分为：黑白相机和彩色相机。
    - 如图是不同色彩模式的工业相机：![image](https://github.com/Mjbetter/learn_document/assets/102216757/b0dfa61a-fb88-4338-b80a-bedac36fad40)
    - 无论是CCD还是CMOS图像传感器，其原理都是将光子转换为电子，其中光子数目与电子数目成比例。对每个像素，统计其电子数目就形成反映光线强弱的灰度图像，也就是说CCD和CMOS图像传感器是“色盲”，不具备辨色的能力，只能形成黑白图像。在黑白工业相机中，光的颜色信息没有被保留，相机直接将光强信号转换成图像灰度值，生成的是单色灰度图像。
    - 虽然CCD和CMOS图像传感器无法区分颜色，只能感受信号的强弱，但是我们可以使用三棱镜通过折射和反射，让光发生色散现象，这样就可以得到三原色(RGB)的光路，接着再用3块感光芯片分别去感知强弱，再综合到一起，这也就是上图所示的三棱镜模式。
    - 因为传感器价格昂贵，柯达的拜尔（Bayer）提出了一种廉价的折中方案（伪彩色相机）：只用一块图像传感器，就解决了颜色的识别。他的做法是在图像传感器前面，设置一个滤光片，上面布满了滤光点，与下层的像素一一对应。如下图所示：  
      ![image](https://github.com/Mjbetter/learn_document/assets/102216757/b4cbb5bc-8071-414c-bb21-1ea102683a3d)
      - Bayer滤光片上的滤光点的排列是有规律的：每个绿点的四周，分布着2个红点、2个蓝点、4个绿点。由于人眼对绿色最为敏感，所以绿色是红、蓝的两倍。由于每个滤光点只能通过红、绿、蓝之中的一种颜色，但是在输出时，所有像素都应该有这三种颜色的信息，被滤除的两种颜色分量值在后期的算法处理中通过插值法或者差值法来补回。  
  - 按照传感器的结构特性可以分为：面阵相机和线阵相机。
    - 面阵相机是以“面”为单位来进行图像采集，是N*N方式排列，面阵相机的传感器拥有更多的感光像素，以矩阵排列，实现的是像素矩阵拍摄。相机拍摄图像中，表现图像细节不是由像素多少决定，是由分辨率决定的（分辨率是由选择的镜头焦距决定的，同一种相机，选用不同焦距的镜头，分辨率就不同，如图所示，也就是说像素的多少不决定图像的分辨率（清晰度），采用大像素相机可以减少拍摄次数，提高测试速度。面阵相机可以一次性获取完整的目标图像，比线阵相机具有更快的检测速度。大多数常见的检测相机都基于面阵扫描，包括测量面积、形状、尺寸、位置，甚至温度，不过面阵相机每行的信息没有线阵多，帧幅率有限。  
      ![image](https://github.com/Mjbetter/learn_document/assets/102216757/103146c6-85e6-4a4b-bb9f-0f6144c644ef)
    - 线阵相机是1*N方式排列，被测视野呈“线”状，其传感器通常只有一行感光元素，以“线”扫描的方式连续拍照，再合成一张巨大的二维图像。线阵相机主要应用于高频扫描和高分辨率的场合，如工业、医疗、科研与安全领域的图象处理。典型应用领域是检测连续的材料，例如金属、塑料、纸和纤维等。被检测的物体通常匀速运动 , 利用一台或多台相机对其逐行连续扫描 , 以达到对其整个表面均匀检测。可以对其图象一行一行进行处理 , 或者对由多行组成的面阵图象进行处理。另外线阵相机非常适合测量场合，这要归功于传感器的高分辨率，它可以准确测量到微米。  
      ![image](https://github.com/Mjbetter/learn_document/assets/102216757/7aae8152-fb3c-4984-a0bc-d30ae94f61bf)
  - 按照芯片类型可以分为：CCD相机和CMOS相机。
    - CCD（Charge Coupled Device）是指"电荷耦合器件"，CMOS（Complementary Metal Oxide Semiconductors）是指互补金属氧化物半导体，这两种图像传感器感光原理类似，基本上都是利用感光二极管进行光与电的转换，将图像转换为数字信息。它们的主要区别是数字信号传送方式不同。
    - CCD图像传感器每一行中每一个像素（pixel）电荷信号都会依序传送到下一个像素中，由最底端的部分输出，再经由传感器边缘的放大器进行放大输出；而在CMOS图像传感器中，每个像素都会连接一个放大器及模数转换电路，用类似内存电路的方式将信号输出。  
      ![image](https://github.com/Mjbetter/learn_document/assets/102216757/a3e2a9ba-4daf-4e5e-9aa0-fba54f654dc4)
    - 两者对比  
      ![image](https://github.com/Mjbetter/learn_document/assets/102216757/05a6c2dc-1f9d-4afb-b414-9f6614eb4501)
  - 按照输出图像信号格式可以分为：模拟相机，数字相机。
    - 模拟相机：模拟相机所输出的信号形式为标准的模拟量视频信号，需要配专用的图像采集卡将模拟信号转化为计算机可以处理的数字信号，以便后期计算机对视频信号的处理与应用。主要优点是通用性好成本低的特点，缺点表现为一般分辨率较低、采集速度慢，且在图像传输中容易受到噪声干扰，导致图像质量下降，所以大多用于对图像质量要求不高的机器视觉系统，早起的机器视觉系统多用模拟相机组成。其视频输出接口形式主要为BNC，S-VIDEO等，所搭配的机器视觉主机大多采用工控机加视频采集卡的形式，整机成本较高。目前主要高清机器视觉应用场景中，模拟相机的使用越来越少。  
      ![image](https://github.com/Mjbetter/learn_document/assets/102216757/72a0a5a0-cf62-46bb-b1c2-b30d26068b27)
    - 数字相机：数字相机顾名思义视频输出信号为数字信号，相机内部集成了A/D转换电路，直接将模拟量的图像信号转化为数字信号，具有图像传输抗干扰能力强，视频信号格式多样，分辨率高，视频输出接口丰富等特点。数字相机的视频输出接口形式主要包括IEEE1394 ，USB3.0，lan等等。  
          - 模拟相机是众多应用的理想选择，因为它有成熟的技术，简单的连线，低成本。连线简单，仅需一根BNC线连接相机到采集卡，而且价格便宜。标准640x480像素分辨率，30帧/秒，满足大多数常见应用。其缺点是：图像尺寸，帧率，比特深度等灵活性不够；不能在使用中编程修改相机设置；市场波动小；如果应用需要高分辨率，比特深度超过8比特，就需要选择一个数字相机。主要有三类数字相机，依据电缆标准区分：并行标准，Camera。
    - 数字相机大多使用并行接口标准，一个良好的标准，提供了大范围的采集速度，图像尺寸，像素深度。并行相机通常需要用户订制电缆和接头，来配合采集卡。其技术优势主要有：高速，高像素深度，大图像尺寸；容易配置相机参数和别的功能。缺点：没有物理或协议标准来接采集卡，需要定制电缆和接头，价格相对较昂贵，图像噪声低。数字相机可以独立与微机配合使用，较简单，属于家用级。而模拟相机，要配合视频捕捉卡一起使用，有负载的处理电路，属于工业级。  
  - 按照扫描方式可分为：隔行扫描相机和逐行扫描相机。
    - 关于扫描方式的一些相关参数的意义
      - 帧：每一帧都是静止的图像，一幅静止的图像被称做一"帧(Frame)"，根据人眼的视觉残留特性，每一秒有24帧。因为光对视网膜所产生的视觉在光停止作用后，仍保留一段时间的现象，原因是由视神经元的反应速度造成的，其时值是二十四分之一秒。
      - 行：在传统CRT模拟电视里，一个电子束在水平方向的扫描被称之为行，或行扫描。
      - 场：在传统CRT模拟电视里，一个行扫描，按垂直的方向扫描被称之为场，或场扫描。
    - 隔行扫描：一帧画面需要由两遍扫描来完成，第一遍只扫描奇数行，即第1、3、5……行，第二遍扫描则只扫描偶数行，即第2、4、6……行，这种扫描方式就是隔行扫描。一幅只含奇数行或偶数行的画面称为“场”，其中只含奇数行的场称为奇数场或前场 (Top Field)， 只含偶数行的场称为偶数场或后场(Bottom Field)。也就是说一个奇数场加上一个偶数场等于一帧(一幅图像)。  
    - 逐行扫描：每帧画面是由若干条水平方向的扫描线组成的、PAL制为625行/帧，NTSC制为525行/帧。如果这一帧画面中所有的行是从上到下一行接一行地连续完成的，或者说扫描顺序是1、2、3……行，我们就称这种扫描方式为逐行扫描。  
      ![image](https://github.com/Mjbetter/learn_document/assets/102216757/08b4b4dd-9b5c-451b-ba91-8f97bd2985dd)
      - 二者之间的区别：逐行扫描克服了隔行扫描的缺点，显示效果的稳定性更强，画面平滑自然无闪烁，动态失真较小。隔行扫描显示效果稳定性偏差，行间闪烁比较明显。如下图所示：
      ![image](https://github.com/Mjbetter/learn_document/assets/102216757/0ac838d7-f764-48a0-9815-815646962af1)
      - 作用上的区别：逐行扫描实现了精确的运动检测和运动补偿，从而克服了传统扫描方式的缺陷。隔行扫描为给定行数提供了两倍显示刷新率的视频信号视频以类似的帧速率，较高的刷新率改善了运动中物体的外观，因为它更频繁地更新其在显示器上的位置。隔行扫描视频还可以提供比逐行扫描更高的空间分辨率。  



